$$WPUtil.guaranteeExistence($$WP,"CommunityUtilities");$$WP.CommunityUtilities.openDeepLink=function(A,f,m,c,s,t,l,y){var i="externalJumpWindow",h=true,d=null,a="community.externaljump",r="@MYCHART@OrganizationName@",j="object",o=[],b,k,q,p;if(!f||typeof f!==j){$$WP.Debug.log("Organization passed in to the function is null or not an object.");return}if(f.IncompleteH2GSetup){$$WP.Strings.addMnemonic(r,f.OrganizationName,"",a);q=new $$WPComp.MessageComponent({TitleText:$$WP.Strings.get("IncompleteH2GPopupTitle",a),Message:$$WP.Strings.get("IncompleteH2GPopupText",a),ToolbarButtons:[new $$WPComp.ComplexObjects.Button($$WP.Strings.get("OkayButtonText",a),d,"cancel","")]});$$WPUtil.quickPopup(q);$$WP.Strings.removeMnemonic(r,a);return}if($$WPUtil.IsNullOrEmpty(l)||isNaN(l))l="-1";if(!c)c=$$WP.CommunityUtilities.openDeepLinkType.InPopup;if(f.IsSSO){if(!c)p=h;c=$$WP.CommunityUtilities.openDeepLinkType.InNewTab}var w=!$$WP.Utilities.UI.IsMobile&&WP.DOM.Browser.isMobile&&$afe.jq(window).width()<768;if((WP.DOM.Browser.isIE||WP.DOM.Browser.isSafari||w)&&c===$$WP.CommunityUtilities.openDeepLinkType.InPopup){c=$$WP.CommunityUtilities.openDeepLinkType.InNewTab;p=h}if(!$$WPUtil.IsNullOrEmpty(m)&&typeof m===j)for(var v in m)o.push({Name:v,Value:m[v]});k=document.location.protocol+"//"+document.location.hostname;if(!$$WPUtil.IsNullOrEmpty(document.location.port))k=k+":"+document.location.port;o.push({Name:"parentJumpGUID",Value:$$WP.CommunityUtilities.getExternalJumpGUID()},{Name:"parentDomain",Value:k},{Name:"lang",Value:$$WP.I18N.getMyChartLocale()});var e={};e.mode=A;e.orgID=f.OrganizationId;e.parameters=o;e.patientIndex=l;!$$WP.Utilities.UI.IsMobile&&closeAllWindows(i);var z=function(e){if(e&&typeof e==="string")e=$.parseJSON(e);if(e&&e.RedirectToSignup&&e.CommunityResponse===d){b.hide();$$WP.CommunityUtilities.ShowSignUpNotAllowedMessage(f);return}if(e&&e.CommunityResponse&&!$$WPUtil.IsNullOrEmpty(e.CommunityResponse.RedirectURL)){e.RedirectToSignup&&$$WP.CommunityUtilities.markCommunityLinkDirty(f.OrganizationId);if(!c){g.loadIframe(e);$$WP.CommunityUtilities.logDeepLinkAudit("3",f.OrganizationId,e.EptId)}else if(b&&b._Components&&b._Components.length>0){$$WP.Strings.setOrganization(e.CommunityResponse.Organization,a);var h=[new $$WPComp.ComplexObjects.Button($$WP.Strings.getForTemplate("Continue",a),d,"completeworkflow","continue"),new $$WPComp.ComplexObjects.Button($$WP.Strings.getForTemplate("cancelNew",a),d,"previousstep","cancel")];if($$WP.Utilities.UI.IsMobile){b._Components[0].setMessage($$WP.Strings.get("redirectMessageForMobile",a));e.CommunityResponse.RedirectURL=makeLink(e.CommunityResponse.RedirectURL+"&launchInBrowser=1")}else b._Components[0].setMessage($$WP.Strings.get("redirectMessage",a));b._Components[0].CallbackArgs=[e];b._Components[0].setToolbar(h);b.setFocus();b.$container.trigger("resize");$$WP.Strings.clearOrganization(a)}}else u()},x=function(a,e){if(e==="toolbarcontinue"){if(typeof a==="string")a=$.parseJSON(a);if(typeof a===j){var d,b;if(c===$$WP.CommunityUtilities.openDeepLinkType.InNewTab)d="";else if(c===$$WP.CommunityUtilities.openDeepLinkType.InNewWindow)d="scrollbars=1,resizable=1";if(a.CommunityResponse.IsSSOPost)b="";else b=a.CommunityResponse.RedirectURL;if(a.CommunityResponse.IsSSOPost){var g=openWindow(b,"",d,i,h);$$WPUtil.postForm(a.CommunityResponse.RedirectURL,a.CommunityResponse.SSOParams,g.name)}else openWindow(b,"",d,i,h);$$WP.CommunityUtilities.logDeepLinkAudit("4",f.OrganizationId,a.EptId);a.RedirectToSignup&&$$WP.CommunityUtilities.markCommunityLinkDirty(f.OrganizationId)}}},u=function(){var e;if(g){e=g.callback;g.callback=d;!c&&g.dispose()}b.hide();var f=new $$WPComp.MessageComponent({Message:$$WP.Strings.get("externalLinkErrorMessage",a),callback:function(){e&&g.runCallback(e)}}),h=new $$WPUtil.quickPopup(f);f.show();h.show()};if(c!==0){if(p)e.access="3";else e.access="4";b=$$WPUtil.quickMessageBox($$WP.Templates.UI.AjaxSpinner({inline:1}),d,[],x,d,"externalJumpRequestPopup Popup");$$WPUtil.ShowAjaxSpinner(b.$content.find(".ajaxspinner"))}else{e.access="3";var g,n;n={};if(s&&t){n.callback=s;n.context=t}g=new $$WPComp.ExternalJumpPopupComponent(n);g.initialize();b=new $$WPContain.Popup({Components:[g],positioningFunction:$$WPContain.Positions.InsideNearTop,Size:$$WPContain.Popup.SizeEnum.LARGE,Class:"externaljumppopup",CommunicationsIndicator:false,BackButtonText:$$WP.Strings.get("ExitPopup",a)});b.show(h);b.setAppropriateScrollBar()}if(y)e.access="5";e=$$WPUtil.postify(e);getCSRFTokenAsQS(function(){$.ajax({url:makeLink("ExternalJump/GetExternalJumpUrl"),type:"POST",data:e,dataType:"json",error:u,cache:false,success:z})})};$$WP.CommunityUtilities.openDeepLinkType={InPopup:0,InNewTab:1,InNewWindow:2};$$WP.CommunityUtilities.logDeepLinkAudit=function logDeepLinkAudit(b,d,c){var a={};a.access=b;a.orgID=d;a.eptId=c;getCSRFTokenAsQS(function(){$.ajax({url:makeLink("ExternalJump/LogExternalJumpAudit"),type:"POST",data:a,cache:false})})};$$WP.CommunityUtilities.markCommunityLinkDirty=function markCommunityLinkDirty(b){var a={};a.organizationId=b;getCSRFTokenAsQS(function(){$.ajax({url:makeLink("Community/External/MarkCommunityLinkDirty"),type:"POST",data:a,cache:false})})};$$WP.CommunityUtilities.refreshCommunityLink=function refreshCommunityLink(c){var b={},a=function refresh(){location.reload()};b.organizationId=c;getCSRFTokenAsQS(function(){$.ajax({url:makeLink("Community/External/RefreshCommunityLink"),type:"POST",data:b,cache:false,error:a,success:a})})};$$WP.CommunityUtilities.getExternalJumpGUID=function getExternalJumpGUID(){if($$WPUtil.IsNullOrEmpty($$WP.CommunityUtilities._externalJumpGUID))$$WP.CommunityUtilities._externalJumpGUID=$$WPUtil.generateRandomGUID();return $$WP.CommunityUtilities._externalJumpGUID};$$WP.CommunityUtilities.getParentJumpGUID=function getParentJumpGUID(){return!$$WPUtil.IsNullOrEmpty($$WP.CommunityUtilities._parentJumpGUID)?$$WP.CommunityUtilities._parentJumpGUID:""};$$WP.CommunityUtilities.clearJumpGUIDs=function clearJumpGUIDs(){$$WP.CommunityUtilities._externalJumpGUID=null;$$WP.CommunityUtilities._parentJumpGUID=null};$$WP.CommunityUtilities.setJumpParameters=function setJumpGUIDs(a,b){if(!$$WPUtil.IsNullOrEmpty(a))$$WP.CommunityUtilities._parentJumpGUID=a;if(!$$WPUtil.IsNullOrEmpty(b))$$WP.CommunityUtilities._parentDomain=b};$$WP.CommunityUtilities.getParentDomain=function getParentDomain(){return!$$WPUtil.IsNullOrEmpty($$WP.CommunityUtilities._parentDomain)?$$WP.CommunityUtilities._parentDomain:""};$$WP.CommunityUtilities.closeExternalParentPopup=function closeExternalParentPopup(){var a={},b;a.externalGUID=$$WP.CommunityUtilities.getParentJumpGUID();a.message="closePopup";b=$$WP.CommunityUtilities.getParentDomain();if(parent)try{parent.postMessage(JSON.stringify(a),b)}catch(c){console.error("Invalid Parent Domain")}WP.Comm.logOut();$$WP.CommunityUtilities.clearJumpGUIDs();$$WP.CommunityUtilities._parentDomain=null;if(self===top)self.location=makeLink("home/logout")};$$WP.CommunityUtilities.externalJumpMessageListener=function externalJumpMessageListener(a){var c=$$WP.CommunityUtilities.getParentDomain();if(a&&a.originalEvent&&a.originalEvent.origin===c&&a.originalEvent.data){var b=JSON.parse(a.originalEvent.data);if(b.message==="logout"){WP.Comm.logOut();$$WP.CommunityUtilities.clearJumpGUIDs()}else if(b.message==="valid")$$WP._isExternalJumpParentValid=true}};$$WP.CommunityUtilities.checkIfCommunityJumpIsValid=function checkIfCommunityJumpIsValid(){var a=$afe.select("body");if(a.hasClass("md_default")&&!a.hasClass("isPrelogin")&&!a.hasClass("PUpage"))self.location=makeLink("closeExternalJumpPopup.asp");else if(self!==top){if(self.window.location.href.toLowerCase().indexOf("/err.asp?")>0)return;var b={},c;b.message="isValidContext";b.externalGUID=$$WP.CommunityUtilities.getParentJumpGUID();c=$$WP.CommunityUtilities.getParentDomain();try{parent.postMessage(JSON.stringify(b),c)}catch(d){console.error("Parent Domain Validation failed")}setTimeout(function(){!$$WP._isExternalJumpParentValid&&top.location.replace(makeLink("home/logout"))},1e3)}};$$WP.CommunityUtilities.openDeepLinkUrl=function(g,f,b,c,d){var a=$$WPUtil.parseQueryString(g),e=a.mode;delete a.mode;$$WP.CommunityUtilities.openDeepLink(e,f,a,b,c,d)};$$WP.CommunityUtilities.ShowSignUpNotAllowedMessage=function(b){var a;$$WP.Strings.setDefaultNamespace("community.externallinking");$$WP.Strings.setOrganization(b);a=$$WP.Strings.get("SignupNotAllowedMessage");$$WP.Strings.clearOrganization();var c=[new $$WPComp.ComplexObjects.Button($$WP.Strings.get("ok","cancelpopup"),null,"previousstep","cancel")];$$WPUtil.quickMessageBox(a,"",c,null,null,"SignupNotAllowed");$afe.select(".SignupNotAllowed.component.Popup").removeClass("textlessTitle");$$WP.Strings.clearDefaultNamespace()};$$WP.CommunityUtilities.hasCommunityLinks=function hasCommunityLinks(){return $afe.select("body").hasClass("hasNoCommunityLinks")?false:true};$$WP.CommunityUtilities.communityChecksuccesscallback=function communityChecksuccesscallback(b){var c,a;if(b!==null&&typeof b!=="undefined"){a=b.isCommunityActive;if(a)c="hasCommunityLinks";else c="hasNoCommunityLinks";$.ajax({url:makeLink("session.asp?mode=updateCommunityActiveCheckFlags&IsCommunityActive="+a)});getCSRFTokenAsQS(function(){$.ajax({url:makeLink("Community/External/UpdateCommunityActiveCheckFlags"),type:"POST"})});$afe.select("body").removeClass("hasNoCommunityLinks hasCommunityLinks").addClass(c)}};$$WP.CommunityUtilities.clearCommunityLinksSessionStatus=function clearCommunityLinksSessionStatus(){$.ajax({url:makeLink("session.asp?mode=clearCommunityActiveCheckFlags")});getCSRFTokenAsQS(function(){$.ajax({url:makeLink("Community/External/ClearCommunityActiveCheckFlags"),type:"POST"})})};$$WP.CommunityUtilities.checkIfCommunityLinksAvailable=function checkIfCommunityLinksAvailable(){var a=$afe.select("body");if(a.hasClass("isPrelogin")||a.hasClass("termsPage"))return;getCSRFTokenAsQS(function(){$.ajax({url:makeLink("Community/External/IsCommunityActive"),dataType:"JSON",type:"POST",cache:false,success:$$WP.CommunityUtilities.communityChecksuccesscallback,failure:function(){$$WP.Debug.log("Community Links available ajax called failed.")}})})};$$WP.CommunityUtilities.getCommunityLinks=function(d,a,c,e){a=a||"*";d=d||function(){};e=e||window;c=c||[];var b=$$WP.CommunityUtilities.getCommunityLinks;if(b._links[a]){c.push(b._links[a]);return d.apply(e,c)}b._callback=d;b._args=c;b._context=e;b._waitingFor=a;getCSRFTokenAsQS(function(){$.ajax({url:makeLink("ExternalJump/GetCommunityLinks?requireSecurityForMode="+a),dataType:"JSON",type:"POST",cache:false,success:$$WP.CommunityUtilities.getCommunityLinks.callStack,failure:function(){$$WP.CommunityUtilities.getCommunityLinks.callStack({ForMode:a,Organizations:[]})}})})};$$WP.CommunityUtilities.getCommunityLinks.callStack=function(b){var a=$$WP.CommunityUtilities.getCommunityLinks;a._links[b.ForMode]=b.Organizations;if(b.ForMode===a._waitingFor&&typeof a._callback==="function"){a._args.push(b.Organizations);a._callback.apply(a._context,a._args)}a._waitingFor=null;a._callback=null};$$WP.CommunityUtilities.getCommunityLinks._links={};$$WP.CommunityUtilities.pickOrganization=function pickOrganization(b,d,a,c){$$WP.CommunityUtilities.getCommunityLinks(function getCommunityLinks(c){if(!c||c.length===0){a.push("1");b.apply(this,a);return}if(c.length===1){a.push(c[0]);b.apply(this,a);return}var h,i,g=[],e,f;f=c.length;if(f>3)f=3;for(e=0;e<c.length;e++)g.push(new $$WPComp.ComplexObjects.Button(new Handlebars.SafeString("<span class='orglogo roundedimage' style='background-image:url("+c[e].LogoUrl+");'></span> <span class='orgname'>"+HTMLEncode(c[e].OrganizationName)+"</span>"),null,"tertiary neutral CommunityLink community_"+f,e));h=new $$WPComp.MessageComponent({Message:d,callback:function(){if(arguments[arguments.length-1]==="close")return;arguments[arguments.length-1]=arguments[arguments.length-1].substr($$WPComp.TOOLBARIDENTIFIER.length);arguments[arguments.length-1]=this.links[arguments[arguments.length-1]];this.fun.apply(this,arguments)},CallbackArgs:a,CallbackContext:{links:c,fun:b},ToolbarButtons:g});i=$$WPUtil.quickPopup(h,{Size:g.length<3?$$WPContain.Popup.SizeEnum.SMALL:$$WPContain.Popup.SizeEnum.MEDIUM,Class:"PickOrganization"});i.show()},c)};$$WP.CommunityUtilities.getOrganization=function(d,c,b,a){if(typeof c!="function")return;a=a||window;b=b||[];$$WP.CommunityUtilities.getCommunityLinks(function(){for(var e=arguments[0],d=arguments[1],c=arguments[2],b=arguments[3],a=0;a<b.length;a++)if(b[a].OrganizationId===e){c.push(b[a]);break}d.apply(this,c)},null,[d,c,b],a)};$$WP.CommunityUtilities.getLoadingOrgNamesForHealthSummary=function getLoadingOrgNamesForHealthSummary(){var a=this;getCSRFTokenAsQS(function(){$.ajax({url:makeLink("Community/Shared/GetLoadingAndErrorOrgNames"),type:"POST",cache:false,data:{controllerType:9},dataType:"json",success:a.instantiateCommunityControllerForHealthSummary})})};$$WP.CommunityUtilities.instantiateCommunityControllerForHealthSummary=function instantiateCommunityControllerForHealthSummary(j){var a=true,h,e,f,b="",i=false,c="",g=false,d;h=isShareEverywhere();e=h?false:a;f=$$WP.Strings.get("NonEpicUpdateDisclaimerText","Community.Shared");b=j.loadingOrgNames;c=j.errorOrgNames;if(b.length>0)i=a;else if(c.length>0)g=a;d=$afe.select("#refresh-banner-container");d.addClass("hidden");d.safeAppend($afe.renderTemplate($$WP.Templates.Community.NonEpicPretextBanner,{ShowDxrBannerAction:e,NonEpicWarningText:f,LoadingOrgNames:b,HasOrgsLoading:i,ErrorOrgNames:c,HasOrgsWithErrors:g}));$$WP.CommunityUtilities.instantiateCommunityController("HealthSummary",a)};$$WP.CommunityUtilities.instantiateCommunityController=function instantiateCommunityController(b,a){return a||$afe.select("#refresh-banner-button").length!==0?new $$WP.Community.CommunityController(b):null};$$WP.CommunityUtilities.createCommunityToast=function createCommunityToast(a,b){if(!a)return;$$WP.UI.Toast.CreateSimpleToast(a,$$WP.UI.Toast.ToastTypeEnum.Warning,$$WP.CommunityUtilities.__saveDismissedFailedConnections.bind(null,b))};$$WP.CommunityUtilities.__saveDismissedFailedConnections=function saveDismissedFailedConnections(a){$.post({url:makeLink("Community/Shared/SaveDismissedFailedConnections"),contentType:"application/json",data:JSON.stringify(a),error:function(){return}})}