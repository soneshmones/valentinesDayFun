var _dateChooser;function callback(c,b,a){document.forms[0].year.value=c;document.forms[0].month.value=getMonthName(b+1);document.forms[0].day.value=a}function createClickFunction(a){function f(b){var e="currentselected",c=WP.Events.getThis(b),d;while(c.nodeName.toUpperCase()!=="TD")c=c.parentNode;d=c.id||c.getAttribute("name");if(d==="calnext"){_dateChooser.drawNextMonth();WP.Events.cancelEvent(b);WP.Events.preventDefault(b);return false}if(d==="calprev"){_dateChooser.drawPreviousMonth();WP.Events.cancelEvent(b);WP.Events.preventDefault(b);return false}if(d==="calcancel"){_dateChooser.clearCalendar();return}var g=d.replace("cal",""),f=makeDate(_dateChooser.year,_dateChooser.month+1,g);if(f.getMonth()!=_dateChooser.month){_dateChooser.year=f.getFullYear();_dateChooser.month=f.getMonth();_dateChooser.date=f.getDate()}else _dateChooser.date=g;$afe.select(".currentselected").removeClass(e);$afe.jq(c).addClass(e);a.call(_dateChooser,_dateChooser.year,_dateChooser.month,_dateChooser.date,_dateChooser.input);_dateChooser.clearCalendar();WP.Events.cancelEvent(b);WP.Events.preventDefault(b);return false}return f}function DateChooser(e,d,f,b,g){var c="UI.Calendar",a=this;a.trigger=e;a.callback=d;a.input=g;a.filter=f||function(){return true};if(b&&typeof b.getYear==="function")a.today=b;else if(typeof b==="string"){a.today=new Date(b);if(isNaN(a.today))a.today=new Date}else a.today=new Date;a.month=a.today.getMonth();a.year=a.today.getFullYear();a.date=a.today.getDate();a.calendar=null;a.clickFunction=createClickFunction(d);a.hoverText=$$WP.Strings.get("SelectTooltip",c);a.hoverTextDisabled=$$WP.Strings.get("NotAvailableTooltip",c)}function isInCalendar(c){var b,a;for(a=c,b=0;a&&b<8;a=a.parentNode,b++)if(a&&a.id&&a.id.toLowerCase()==="calendar")return true;return false}function lo(b){var a=WP.Events.getThis(b);while(a.nodeName.toUpperCase()!=="TD")a=a.parentNode;$afe.jq(a).removeClass("hi")}function hi(b,a){return function(d){var c=WP.Events.getThis(d);if(a)while(c.nodeName.toUpperCase()!=="DIV")c=c.parentNode;else while(c.nodeName.toUpperCase()!=="TD")c=c.parentNode;$afe.jq(c).addClass("hi");if((!$afe.jq(c).hasClass("ctrl")||b)&&_dateChooser.focusOn&&_dateChooser.focusOn!==c.id){document.getElementById(_dateChooser.focusOn)&&lo({target:document.getElementById(_dateChooser.focusOn),srcElement:document.getElementById(_dateChooser.focusOn)});_dateChooser.focusOn=c.id}}}function restoreHi(c){var b=WP.Events.getThis(c),a;if(b&&b.className!=="calendar"&&!isInCalendar(b)){a="cal"+_dateChooser.date;if(_dateChooser.focusOn&&a!==_dateChooser.focusOn)if(_dateChooser.month===_dateChooser.today.getMonth()&&_dateChooser.year===_dateChooser.today.getFullYear()&&document.getElementById(a).firstChild.tagName)document.getElementById(a).firstChild.focus();else{a=document.getElementById(_dateChooser.focusOn);a.firstChild&&a.firstChild.blur();lo({target:a,srcElement:a})}}}function _removeCalendar(){var a=$afe.select("#calendar");if(a.length>0){WP.Events.removeListener(document.body,"click",removeCalendar);WP.Events.removeListener(document.body,"mouseover",restoreHi);accessibilityRestorePage();a.remove();_dateChooser=null}}function removeCalendar(b){var a=WP.Events.getThis(b);a&&a.className!=="calendar"&&!isInCalendar(a)&&_removeCalendar()}function keyOnPrevMonth(b){var a;if(b.keyCode===9){if(b.shiftKey){a=document.getElementById("calcancel").firstChild;if(a&&a.nodeName.toUpperCase()==="A")a.focus();else document.getElementById("cal"+_dateChooser.lastDate).firstChild.focus();return WP.Events.preventDefault(b)}return}if(b.keyCode===13)_dateChooser.wasEnter=true}function keyOnNextMonth(b){var a;if(b.keyCode===9){if(b.shiftKey){a=document.getElementById("calprev").firstChild;if(!a||a.nodeName.toUpperCase()!=="A"){a=document.getElementById("calcancel").firstChild;if(a&&a.nodeName.toUpperCase()==="A")a.focus();else document.getElementById("cal"+_dateChooser.lastDate).firstChild.focus();return WP.Events.preventDefault(b)}}return}if(b.keyCode===13)_dateChooser.wasEnter=true}function tabOnCancel(b){var a;if(b.keyCode===9){if(b.shiftKey)return;a=document.getElementById("calprev").firstChild;if(a&&a.nodeName.toUpperCase()==="A")a.focus();else{a=document.getElementById("calnext").firstChild;if(a&&a.nodeName.toUpperCase()==="A")a.focus();else document.getElementById("cal"+_dateChooser.firstDate).firstChild.focus()}return WP.Events.preventDefault(b)}}DateChooser.prototype.drawCalendar=function(c){var j="keydown",g="cal",h="0px",q="calendar",a=this;c=c===undefined?null:c;_removeCalendar(true);_dateChooser=a;var b=document.createElement("div"),f,u,i,d,k,v,m,l,t,n,o;v=new Date;b.id=q;b.className=q;b.setAttribute("role","dialog");b.setAttribute("aria-modal","true");b.setAttribute("aria-labelledby","monthlabel");a.lastDayOfMonth=new Date(a.year,a.month+1,0);a.lastDateOfMonth=a.lastDayOfMonth.getDate();var s=getFirstDayOfWeek(),e=a.lastDayOfMonth.getDay()-s;a.lastDisplayedDateId=e>=0?a.lastDateOfMonth-e+6:a.lastDateOfMonth-e+7;e=new Date(a.year,a.month,1).getDay()-s;a.firstDisplayedDateId=e>=0?1-e:-e-6;b.appendChild(a.getCalendarObject());a.setClickFunction(b);k=document.documentElement.className.indexOf("mobile")>=0;if(!a.trigger.offsetParent)a.trigger=document.getElementById(a.trigger.id);if(a.trigger.offsetParent){b.style.position="absolute";f=getElementPosition(a.trigger);u=f.topElement;u.appendChild(b);$$WPContain.Popup.__zIndex+=3;b.style.zIndex=3e3+$$WPContain.Popup.__zIndex;b.style.left=f.x;b.style.top=f.y;n=$afe.select("html.datatile")[0];t=$afe.jq(a.trigger).parents(".Popup")[0];o=document.getElementById("main");i=t||n||o;m=i.offsetWidth;l=i.offsetHeight;f=getElementPosition(a.trigger,i);if(b.offsetWidth){var p=parseInt(b.style.left,10);d=parseInt(f.x,10)+b.offsetWidth-m;if(d>0)if(d<p)b.style.left=p-d+"px";else b.style.left=h}if(b.offsetHeight){var r=parseInt(b.style.top,10);d=parseInt(f.y,10)+b.offsetHeight-l;if(d>0)if(d<r)b.style.top=r-d+"px";else b.style.top=h}if(k){b.style.left=h;b.style.position="fixed";b.style.top=h}}else{$afe.jq(a.trigger.parentNode).safeInsertBefore(b,a.trigger);$afe.jq(a.trigger).addClass("hidden")}$afe.select(".currentselected").removeClass("currentselect");a.calendar=b;WP.Events.addListener(document.body,"click",removeCalendar);WP.Events.addListener(document.body,"mouseover",restoreHi);if(c!==undefined&&c!==null){c=c>a.lastDateOfMonth?a.lastDateOfMonth:c;document.getElementById(g+c).firstChild.focus()}else if(a.month===a.today.getMonth()&&a.year===a.today.getFullYear()&&document.getElementById(g+v.getDate())){document.getElementById(g+a.date).firstChild.focus();a.focusOn=g+a.date}else{document.getElementById(g+a.firstDate).firstChild.focus();a.focusOn=g+a.firstDate}WP.Events.addListener(document.getElementById("calprev"),j,keyOnPrevMonth);WP.Events.addListener(document.getElementById("calnext"),j,keyOnNextMonth);WP.Events.addListener(document.getElementById("calcancel"),j,tabOnCancel);accessibilityHidePage();a.firstDate="";a.lastDate="";if(k)$afe.jq(b).on("touchmove",function(a){$$WP.Utilities.Mobile.Optimization.IgnoreTouchMove(a,true)})};DateChooser.prototype.clearCalendar=function(){var a=this;_removeCalendar();a.callback();a.trigger.className=a.trigger.className.replace(" hidden","");a.input.focus()};DateChooser.prototype.setClickFunction=function(f){for(var h=this.hoverText,g=this.hoverTextDisabled,k=this.clickFunction,e=f.getElementsByTagName("td"),b,a,l=new Date,j=document.all?"hand":"pointer",d=function(a,c){var b="mouseover";WP.Events.addListener(a,"click",k);if(a.className==="ctrl"){WP.Events.addListener(a,b,hi());WP.Events.addListener(a,"mouseout",lo);WP.Events.addListener(a.firstChild,"focus",hi(true));WP.Events.addListener(a.firstChild,"blur",lo)}else{WP.Events.addListener(a,b,function(){a.firstChild.focus()});WP.Events.addListener(a.firstChild,"focus",hi())}a.style.cursor=j;if(c!==true)a.firstChild.title=h},i=function(a){a.style.cursor="default";a.title=g},c=0;c<e.length;++c){b=e[c];a=b.className;if(a==="null"||a==="hdr"||!b.firstChild)continue;if(a==="ctrl")d(b,true);else if(a.indexOf("wkndn")>=0||a.indexOf("n")===0||a.indexOf("ctrln")>=0)i(b);else d(b)}WP.Events.addListener(f,"keydown",HandleKeyDown)};DateChooser.prototype.isDateDisplayed=function(a){return a>=this.firstDisplayedDateId&&a<=this.lastDisplayedDateId};function HandleKeyDown(f){var d=true,b=false,c=document.activeElement;while(c.nodeName.toUpperCase()!=="TD")c=c.parentNode;var g=c.id||c.getAttribute("name"),a={TAB:9,ESC:27,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40};f.keyCode==a.ESC&&_dateChooser.clearCalendar();if(c.className.indexOf("ctrl")<0){var e=g.replace("cal","");switch(f.keyCode){case a.RIGHT:moveFocusByDay(e,1);b=d;break;case a.LEFT:moveFocusByDay(e,-1);b=d;break;case a.DOWN:moveFocusByDay(e,7);b=d;break;case a.UP:moveFocusByDay(e,-7);b=d;break;case a.PAGEDOWN:moveFocusByMonth(e,1);b=d;break;case a.PAGEUP:moveFocusByMonth(e,-1);b=d;break;case a.HOME:moveFocusToFirstDayOfWeek(e);b=d;break;case a.END:moveFocusToLastDayOfWeek(e);b=d}c=document.activeElement;if(_dateChooser!==null&&c.tabIndex=="0")_dateChooser.focusOn=c.parentElement.id;if(b){f.stopPropagation();f.preventDefault()}}}function moveFocusToFirstDayOfWeek(b){var f=_dateChooser.year,e=_dateChooser.month,c=new Date(f,e,b),a=c.getDay()-getFirstDayOfWeek();a=a<0?a+7:a;var d=b-a;document.getElementById("cal"+d).firstChild.focus()}function moveFocusToLastDayOfWeek(b){var f=_dateChooser.year,e=_dateChooser.month,c=new Date(f,e,b),a=c.getDay()-getFirstDayOfWeek();a=a<0?-1-a:6-a;var d=parseInt(b)+a;document.getElementById("cal"+d).firstChild.focus()}function moveFocusByDay(h,e){var g=_dateChooser.year,f=_dateChooser.month,a=parseInt(h)+e,b=new Date(g,f,a),c=b.getMonth(),d=b.getFullYear();if(e>0&&(c>f||d>g))if(hasSelectableDay(c,d))_dateChooser.drawNextMonth(b.getDate());else _dateChooser.isDateDisplayed(a)&&document.getElementById("cal"+a).firstChild.focus();else if(e<0&&(c<f||d<g))if(hasSelectableDay(c,d))_dateChooser.drawPreviousMonth(b.getDate());else _dateChooser.isDateDisplayed(a)&&document.getElementById("cal"+a).firstChild.focus();else document.getElementById("cal"+a).firstChild.focus()}function moveFocusByMonth(c,b){c=parseInt(c);var e=_dateChooser.year,d=_dateChooser.month,f=new Date(e,d,c),a=f.getDate();if(b==1&&c<=0||b==-1&&c>_dateChooser.lastDateOfMonth){a=a>_dateChooser.lastDateOfMonth?_dateChooser.lastDateOfMonth:a;document.getElementById("cal"+a).firstChild.focus()}else if(hasSelectableDay(d+b,e))if(b==1)_dateChooser.drawNextMonth(a);else b==-1&&_dateChooser.drawPreviousMonth(a);else if(Math.abs(b)==1){a=b===1?a+new Date(e,d+1,0).getDate():a-new Date(e,d,0).getDate();_dateChooser.isDateDisplayed(a)&&document.getElementById("cal"+a).firstChild.focus()}}DateChooser.prototype.drawNextMonth=function(c){var a=this;c=c===undefined?null:c;a.clearCalendar();a.month=(a.month+1)%12;if(a.month===0)a.year++;a.drawCalendar(c);if(!c&&!a.wasEnter&&a.month!==a.today.getMonth()){var b=document.getElementById("calnext");if(b!==null){b=b.firstChild;b&&b.nodeName.toUpperCase()==="A"&&b.focus()}}};DateChooser.prototype.drawPreviousMonth=function(b){var a=this;b=b===undefined?null:b;a.clearCalendar();a.month=a.month-1;if(a.month<0)a.month+=12;if(a.month===11)a.year--;a.drawCalendar(b);if(!b&&!a.wasEnter&&a.month!==a.today.getMonth()){var c=document.getElementById("calprev").firstChild;c&&c.nodeName.toUpperCase()==="A"&&c.focus()}};DateChooser.prototype.getCalendarObject=function(){var v="role",E="tabindex",p="true",u="aria-hidden",o="aria-label",m="ctrl",l="td",n="tr",b="",k="UI.Calendar",h=this,t=document.createElement("table"),z=document.createElement("thead"),y=document.createElement("tbody"),d,a,c,f=h.month,g=h.year,L=h.filter,s,j,e,A=new Date,K=A.getDate(),I=A.getMonth(),J=A.getFullYear(),i=WP.DOM.Create.tag,r=$$WP.Strings.get("PrevButtonOverride",k),D=$$WP.Strings.get("PrevButtonTooltip",k),q=$$WP.Strings.get("NextButtonOverride",k),C=$$WP.Strings.get("NextButtonTooltip",k),G=$$WP.Strings.get("CancelButton",k),F=$$WP.Strings.get("CancelTooltip",k);if(r===b)r="&laquo;";if(q===b)q="&raquo";j=!hasSelectableDay(f,g);d=document.createElement(n);if(hasSelectableDay(f-1,g)||j){a=i(l,m+(hasSelectableDay(f-1,g)||j?b:"n"),"calprev",D);c=WP.DOM.Create.anchoredNode(r,false,b);a.appendChild(c);c.setAttribute(o,D)}else{a=i(l,m+(hasSelectableDay(f-1,g)||j?b:"n"),"calprev",$$WP.I18N.monthTitleFormat(makeDate(g,f)),r);a.setAttribute(u,p)}d.appendChild(a);d.appendChild(i("th","hdr calmonth","monthlabel",b,$$WP.I18N.monthTitleFormat(makeDate(g,f+1))));d.lastChild.colSpan=5;if(hasSelectableDay(f+1,g)||j){a=i(l,m+(hasSelectableDay(f+1,g)||j?b:"n"),"calnext",C);c=WP.DOM.Create.anchoredNode(q,false,b);a.appendChild(c);c.setAttribute(o,C)}else{a=i(l,m+(hasSelectableDay(f+1,g)||j?b:"n"),"calnext",$$WP.I18N.monthTitleFormat(makeDate(g,f+2)),q);a.setAttribute(u,p)}d.appendChild(a);z.appendChild(d);d=document.createElement(n);for(s=0;s<7;s++){a=i("th","hdr",b,b,getDayLetter((s+getFirstDayOfWeek())%7));$afe.jq(a).safeAttr(u,p);d.appendChild(a)}z.appendChild(d);t.appendChild(z);var w,H=function(a,j){var h=a.getMonth(),f=a.getDate(),i=a.getFullYear(),d,g=a.getDay(),c,e;c=g===0||g===6;e=h===I&&f===K&&i===J;d=(L(i,h,f)?c?"wknd":"d":c?"wkndn":"n")+(e?" today":b)+(j?" othermonth":b);return d},M,x,B=h.firstDisplayedDateId,e=new Date(g,f,B);while(e.getMonth()!==f+1&&e.getFullYear()<=g){d=document.createElement(n);for(x=0;x<7;x++){w=e.getMonth()!==f;a=i(l,H(e,w),"cal"+B);c=i("button",b,b,b,e.getDate());c.setAttribute(o,$$WP.I18N.getCalendarDateAriaString(e));if(h.filter(e.getFullYear(),e.getMonth(),e.getDate())){c.setAttribute(E,"0");if(!w){if(!h.firstDate||h.firstDate===b)h.firstDate=e.getDate();if(!h.lastDate||h.lastDate<e.getDate())h.lastDate=e.getDate()}}else{c.setAttribute(E,"-1");c.setAttribute("aria-disabled",p);c.style.cursor="default"}a.appendChild(c);e.getTime()===_dateChooser.today.getTime()&&applyClass(a,"currentselected");d.appendChild(a);e.setDate(e.getDate()+1);B++}y.appendChild(d)}d=document.createElement(n);a=i(l,m,"calcancel",F);a.setAttribute(v,"presentation");c=WP.DOM.Create.anchoredNode(G);$afe.jq(c).safeAttr(v,"option");$afe.jq(c).safeAttr(o,F);a.appendChild(c);d.appendChild(a);d.firstChild.colSpan=7;y.appendChild(d);$afe.jq(t).safeAttr(v,"grid");t.appendChild(y);return t};function dfltClndrCallbackFactory(a){return function(e,c,d){var b=document.getElementById(a);if(b){b.holdErrors=false;b.openingCalendar=false;if(e&&!isNaN(c)&&c>-1&&c<12&&d){b.value=formatDate(new Date(e,c,d));_dateChooser.today=parseDate(b.value,true);WP.Events.fireEvent(b,"change");b.focus()}}}}function textBoxDataChooser(h,f,i,a){var c,g,b,e,d;b=document.getElementById(f);if(typeof a==="string"&&a.length>0)c=window[a](f);else if($.isFunction(a))c=a;if(typeof c!=="function")c=dfltClndrCallbackFactory(f);d=$afe.jq(b).safeAttr("data-focus-dte");if(b.value!=="")e=parseDate(b.value,true);else if(typeof d!=="undefined")e=WP.Utils.dte2date(d);g=new DateChooser(h,c,WP.Validators.Calendar[i],e,b);g.drawCalendar()}function writeCalendar(a,g,k,h,i,j,l,f){var b=false,c="holdErrors",e="openingCalendar",d;if(typeof a==="string")a=$afe.select("#"+a);d=$$WP.SimpleTemplates.Anchor({href:"#","class":"calendar datechooserAnchor"});!$$WPUtil.IsNullOrEmpty(f)&&d.safeAttr("id",f);d.safeAppend($$WP.SimpleTemplates.Img({src:k,alt:$$WP.Strings.get("CalImgAlt","UI.Calendar")}));if(g==="range"){if(!$$WPUtil.IsNullOrEmpty(h))window.cachedStartDate=WP.Utils.dte2date(h);if(!$$WPUtil.IsNullOrEmpty(i))window.cachedEndDate=WP.Utils.dte2date(i)}d.click(function(){a.prop(e,true);a.prop(c,b);textBoxDataChooser(d[0],a.prop("id"),g,j);return b}).on("mousedown",function(){a.prop(c,true)}).on("mouseout",function(){a.prop(c,b);a.prop(e,b)});d.safeInsertAfter(a)}function clearCalendarDateRange(){window.cachedStartDate=null;window.cachedEndDate=null}function hasSelectableDay(b,d){var c=1,a=makeDate(d,b+1,c);b=a.getMonth();while(a.getMonth()===b){if(_dateChooser.filter(a.getFullYear(),a.getMonth(),c))return true;a.setDate(++c)}return false}function pageLo(b){var a=WP.Events.getThis(b);while(a.nodeName.toUpperCase()!=="DIV")a=a.parentNode;$afe.jq(a).removeClass("hover")}function pageHi(){return function(b){var a=WP.Events.getThis(b);while(a.nodeName.toUpperCase()!=="DIV")a=a.parentNode;$afe.jq(a).addClass("hover");_dateChooser.focusOn&&_dateChooser.focusOn!==a.id&&pageLo({target:document.getElementById(_dateChooser.focusOn),srcElement:document.getElementById(_dateChooser.focusOn)});_dateChooser.focusOn=a.id}}function pageCalendarEffects(){var d,b,c,a;d=document.getElementById("pagecalendar");if(d!==null){_dateChooser=function(){};b=d.getElementsByTagName("div");if(b!==null)for(c=0;c<b.length;c++){a=b[c];if($afe.jq(a).hasClass("NoData")||$afe.jq(a).hasClass("EditData")||$afe.jq(a).hasClass("ctrl")){WP.Events.addListener(a,"mouseover",function(){this.firstChild.focus()});WP.Events.addListener(a,"mouseout",function(){this.firstChild.blur()});WP.Events.addListener(a.firstChild,"focus",pageHi());WP.Events.addListener(a.firstChild,"blur",pageLo)}}}}function accessibilityHidePage(){var a=accessibilityGetElements();for(i=0;i<a.length;i++)a[i]&&a[i].setAttribute("aria-hidden","true")}function accessibilityRestorePage(){var a=accessibilityGetElements();for(i=0;i<a.length;i++)a[i]&&a[i].removeAttribute("aria-hidden")}function accessibilityGetElements(){return[document.getElementById("header"),document.getElementById("footer"),document.getElementById("content")]}$$WP.Utilities.UI.Calendars=function $$WP$Utilities$UI$Calendars(b){var a;if(b.type==="load"){a=$afe.select("input.date.withCalendar");a.each(function(){var a=$afe.jq(this);!a.next().is("a.datechooserAnchor")&&writeCalendar(a,a.safeAttr("data-filter"),makeStaticLink("images/calendar.svg"),a.safeAttr("data-filter-from"),a.safeAttr("data-filter-to"),a.safeAttr("data-callback"))})}};$$WP.Utilities.UI.Map.Support.calendars=$$WP.Utilities.UI.Calendars