/*! Copyright (c) Epic Systems Corporation 2016-2018 */
$$WPComp.ExternalJumpPopupComponent=function WPComp$ExternalJumpPopupComponent(b){var a=this;a.Components$TemplateComponent(b);a.Data=a.Data||{};a.addEventListener("click",a._clickEvent);a.Data.ExternalJumpIframeId="externaljumpiframe_comp"+a.ComponentNumber;a.ExternalJumpIframeId=a.Data.ExternalJumpIframeId};$$WPComp.ExternalJumpPopupComponent.prototype={Class:"externaljump",ToolbarButtons:null,template:$$WP.Templates.Core.externaljump,CommunicationsIndicator:false,ExternalJumpIframe:null,IsLoadingIndicatorHidden:false,ResponseObject:null,NewWindowReference:null,ExternalJumpIframeId:null,RefreshCommunityTokenOnClose:false,callback:null,context:null,windowMsgListener:null,initialize:function $$WPComp$externaljump$initialize(){this.clearModel();this.refresh()},clearModel:function $$WPComp$externaljump$clearModel(){var a=this;if(a.Data){a.Data.OrganizationName=null;a.Data.OrganizationLogo=null;a.Data.Url=null}},loadIframe:function $$WPComp$externaljump$loadIframe(b){var a=this;if(typeof b==="object"){a.updateData(b.CommunityResponse);a.ResponseObject=b.CommunityResponse;a.RefreshCommunityTokenOnClose=b.RedirectToSignup;a.Data.IsSignupWorkFlow=b.RedirectToSignup;a.Data.Url=a.ResponseObject.RedirectURL;a.refresh();$afe.select("#"+a.ExternalJumpIframeId).on("load",$.proxy(a.afterIframeLoaded,a)).on("error",a.failure);a.ExternalJumpIframe=document.getElementById(a.ExternalJumpIframeId)}a.windowMsgListener=$.proxy(a.msgListener,a);$afe.jq(window).on("message."+a.ComponentNumber,a.windowMsgListener);$afe.jq(window).on("resize orientationchange","",a.ComponentNumber,$.proxy(a._resizeIframe,a));a.ContainerComponent._oldDispose=a.ContainerComponent.dispose;a.ContainerComponent.dispose=$.proxy(a._popupDispose,a)},afterIframeLoaded:function $$WPComp$externaljump$afterIframeLoaded(){this.hideLoadingIndicator()},hideLoadingIndicator:function $$WPComp$externaljump$hideLoadingIndicator(){var a=this,c,b;if(a.IsLoadingIndicatorHidden)return;c=a.$content.find(".loadingExt");c.removeClass("loading").addClass("loaded");b=a.$content.find(".loadingContainer");b.addClass("loaded").on("transitionend transitionEnd",$.proxy(a.showIframeContent,a));WP.DOM.Browser._getIEVersion()===9&&setTimeout($.proxy(a.showIframeContent,a),500);a.IsLoadingIndicatorHidden=true},showIframeContent:function $$WPComp$externaljump$showIframeContent(){var a=this;a.$content.find(".loadingContainer").remove();a.$content.find(".loadedcontent").removeClass("loadedcontent");$.proxy(a._resizeIframe(),a);a.ContainerComponent.focus()},_resizeIframe:function $$WPComp$externaljump$_resizeIframe(){var d="height",i=".externalframewrapper",g="max-height",c,h,e,a,f,b;h=$afe.select(".externalheader").outerHeight();e=600;a=$afe.select("#"+this.ExternalJumpIframeId);if(a.length===0)return;f=a.closest(".Popup");if(f.length>0){b=f.find("> .content");if($$WP.Utilities.isBrowserCapableOf("touchEvents")&&b.css(g)==="none"){a.closest(i).css(d,"");a.css(d,"100vh");return}if(!$afe.select("body").hasClass("scrollDisabled")||b.css(g)==="none")c=b.height();else c=$$WPUtil.cssValueToPixels(b.css(g));if(typeof c!=="undefined")e=c-h-5}a.css(d,e+"px");a.closest(i).css(d,e+"px")},showBrowserUnSupportedMessage:function $$WPComp$externaljump$showBrowserUnSupportedMessage(){var f="UnSupportedBtnTextNew",e=".browsersupport",c="community.externaljump",d="UnSupportedMessage",b,a;b=$$WP.SimpleTemplates.Div({id:d},null);$$WP.Strings.setDisplayText(b,"UnSupportedMessageNew",c);this.$content.find(e).safeAppend(b);a=$$WP.SimpleTemplates.Anchor({href:"#","data-id":"unsupportedbrowserlink","class":"button completeworkflow autowidth",title:$$WP.Strings.get(f,c),"aria-describedby":d});$$WP.Strings.setDisplayText(a,f,c);this.$content.find(e).safeAppend(a)},failure:function $$WPComp$externaljump$failure(){this.Data.ErrorMessage=$$WP.Strings.getForTemplate("WidgetErrorMessage");this.refresh()},updateData:function $$WPComp$externaljump$updateData(b){var c="community.externaljump",a=this;if(b&&b.Organization){a.Data.OrganizationLogo=b.Organization.LogoUrl;a.Data.OrganizationName=b.Organization.OrganizationName;$$WP.Strings.setOrganization(b.Organization,c);a.Data.LoadingStatus=$$WP.Strings.getForTemplate("DeepLinkPopupLoadingMessage",c);a.Data.IframeTitle=$$WP.Strings.getForTemplate("IframeTitle",c);$$WP.Strings.clearOrganization();a.Data.Address=b.Organization.Address;a.Data.Contact=b.Organization.ContactInformation;if(a.Data.Contact===null)a.Data.contactInfoClass="nocontact"}},msgListener:function $$WPComp$externaljump$msgListener(c){var a=this;if(c&&c.originalEvent&&c.originalEvent.data){var b=JSON.parse(c.originalEvent.data);if(!b)return;if(b.message==="cookieFlag"&&!b.canSetCookies){a.hideLoadingIndicator();$afe.select("#"+a.ExternalJumpIframeId).remove();a.showBrowserUnSupportedMessage();return}if(b.externalGUID===$$WP.CommunityUtilities.getExternalJumpGUID())if(a)if(b.message==="closePopup"){a.ContainerComponent&&a.ContainerComponent._oldDispose();a&&a._disposeTimeout&&clearTimeout(a._disposeTimeout)}else if(b.message==="isValidContext"){if(a.ExternalJumpIframe&&a.ExternalJumpIframe.contentWindow){var d={};d.message="valid";a.ExternalJumpIframe.contentWindow.postMessage(JSON.stringify(d),"*")}}else b.message==="setActivity"&&$$WPUtil.setActivity()}},_clickEvent:function $$WPComp$externaljump$_clickEvent(d){var c="externalJumpWindow",b="scrollbars=1,resizable=1",a=this;if(!d)return true;if(d.dataId==="unsupportedbrowserlink")if(a.ResponseObject!==null&&!$$WPUtil.IsNullOrEmpty(a.ResponseObject.RedirectURL)){if(a.ResponseObject.IsSSOPost){a.NewWindowReference=openWindow("","",b,c,true);$$WPUtil.postForm(a.ResponseObject.RedirectURL,a.ResponseObject.SSOParams,a.NewWindowReference.name)}else{a.ResponseObject.RedirectURL=a.ResponseObject.RedirectURL+"&co=true";a.NewWindowReference=openWindow(a.ResponseObject.RedirectURL,"",b,c,true)}return false}},_popupDispose:function $$WPComp$externaljump$popupDispose(){var a=this;if(a){if(a.ExternalJumpIframe&&a.ExternalJumpIframe.contentWindow||a.NewWindowReference!==null&&!a.NewWindowReference.closed){var b={};b.message="logout";if(a.NewWindowReference!==null)a.NewWindowReference.window.postMessage(JSON.stringify(b),"*");else a.ExternalJumpIframe.contentWindow.postMessage(JSON.stringify(b),"*")}a.ContainerComponent.hide();a._disposeTimeout=setTimeout($.proxy(function(){var a=this;a.NewWindowReference!==null&&!a.NewWindowReference.closed&&closeAllWindows("externalJumpWindow");a.ContainerComponent&&a.ContainerComponent._oldDispose()},a),500)}},dispose:function $$WPComp$externaljump$dispose(){var a=this;$afe.jq(window).off("message."+a.ComponentNumber,a.windowMsgListener);$afe.jq(window).off("resize orientationchange","",$.proxy(a._resizeIframe,a));a.ResponseObject!==null&&a.RefreshCommunityTokenOnClose&&$$WP.CommunityUtilities.refreshCommunityLink(a.ResponseObject.Organization.OrganizationId);a.runCallback(a.callback);a.Components$Component$dispose()},runCallback:function $$WPComp$externaljump$runCallback(a){a&&this.context&&typeof a==="function"&&a.apply(this.context)}};$$WPComp.ExternalJumpPopupComponent.extend("Components.TemplateComponent")