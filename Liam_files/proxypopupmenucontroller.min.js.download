(function ClassDefinition(){var a=null;$$WP.Utilities.guaranteeExistence($$WP,"ProxySwitch.Controllers");var b=function WP$ProxySwitch$Controllers$ProxyPopupMenuController(e,d){var a=this;a.$root=e;a.parentController=d;a.menuitems=[];childElements=a.$root.find("li");var b=a;childElements.each(function(c,a){if(a.children.length<1)return;menuElement=a.children[0];if(!menuElement||menuElement.tagName.toUpperCase()!=="A")return;b.menuitems.push(a);menuElement.onclick=b._handleClick.bind(b,menuElement);a.onkeydown=b._handleKeydown.bind(b,a)});var c=a.menuitems.length;if(c>0){a.firstItem=a.menuitems[0];a.lastItem=a.menuitems[c-1]}a.keyCode={TAB:9,RETURN:13,ESC:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40}},c={$root:a,parentController:a,menuitems:a,firstChars:a,firstItem:a,lastItem:a,hasFocus:false,currentItem:a,setFocusToController:function(){this.parentController.$menuButton.focus()},setFocusToFirstItem:function(){this.firstItem.focus();this.currentItem=this.firstItem},setFocusToLastItem:function(){this.lastItem.focus();this.currentItem=this.lastItem},setFocusToPreviousItem:function(){var a=this,b;if(a.currentItem===a.firstItem)a.setFocusToLastItem();else{b=a.menuitems.indexOf(a.currentItem);a.menuitems[b-1].focus();a.currentItem=a.menuitems[b-1]}},setFocusToNextItem:function(){var a=this,b;if(a.currentItem===a.lastItem)a.setFocusToFirstItem();else{b=a.menuitems.indexOf(a.currentItem);a.menuitems[b+1].focus();a.currentItem=a.menuitems[b+1]}},_removeLinks:function(a){this.menuitems.forEach(function(b){if(b.href===a)return;b.href="#"})},_handleClick:function(a,b){if(a.dataset.closedropdown==="true"){this.setFocusToController();this.parentController.closeProxyDropdown();b.stopImmediatePropagation()}else a.href&&a.href!=="#"&&a.dataset.switchpatients==="true"&&$$WPUtil.SafeToRedirect(function(d){var c="#itemFeedContainer a",b=".proxySubjectLink";if(d){$$WPUtil.TryRedirect(a.href);$afe.select(b).removeAttr("href");$afe.select(b).removeAttr("onclick");$afe.select(c).removeAttr("href");$afe.select(c).removeAttr("onclick")}})},_handleKeydown:function(e,c){var b=true,a=this,d=false;if(c.ctrlKey||c.altKey||c.metaKey)return;if(c.shiftKey){if(c.keyCode===a.keyCode.TAB){a.setFocusToPreviousItem(a);d=b}}else switch(c.keyCode){case a.keyCode.ESC:a.setFocusToController();a.parentController.closeProxyDropdown();return;case a.keyCode.UP:a.setFocusToPreviousItem(a);d=b;break;case a.keyCode.DOWN:case a.keyCode.TAB:a.setFocusToNextItem(a);d=b;break;case a.keyCode.HOME:case a.keyCode.PAGEUP:a.setFocusToFirstItem();d=b;break;case a.keyCode.END:case a.keyCode.PAGEDOWN:a.setFocusToLastItem();d=b;break;case a.keyCode.RETURN:case a.keyCode.SPACE:e.firstElementChild.click();d=b}if(d){c.stopPropagation();c.preventDefault()}}};b.prototype=c;$$WP.ProxySwitch.Controllers.ProxyPopupMenuController=b;b.extend($$WP.Controllers.Controller,"WP$ProxySwitch$Controllers$ProxyPopupMenuController")})()